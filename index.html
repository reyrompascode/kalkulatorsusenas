<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>KALKULATOR SUSENAS</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Poppins", sans-serif;
        background-color: #f0f2f5;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px;
        min-height: 100vh;
        margin: 0;
      }
      .main-header {
        color: #2c3e50;
        text-align: center;
        margin-bottom: 30px;
      }
      .logo {
        max-width: 250px;
        height: auto;
        margin-bottom: 20px;
      }
      .calculators-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 20px;
        width: 100%;
        max-width: 1200px;
      }
      .calculator-section {
        background-color: #ffffff;
        padding: 40px;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        text-align: center;
        flex: 1 1 450px;
      }
      h2 {
        color: #333;
        margin-bottom: 25px;
        border-bottom: 2px solid #eee;
        padding-bottom: 10px;
      }
      .input-group,
      .form-group {
        margin-bottom: 20px;
        text-align: left;
      }
      label {
        display: block;
        margin-bottom: 8px;
        color: #555;
        font-weight: 600;
      }
      input[type="date"],
      input[type="number"],
      input[type="text"] {
        width: 100%;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 8px;
        box-sizing: border-box;
        font-size: 16px;
      }
      .button-group {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-top: 20px;
      }
      button {
        background-color: #007bff;
        color: white;
        padding: 12px 25px;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        cursor: pointer;
        transition: background-color 0.3s ease;
      }
      button:hover {
        background-color: #0056b3;
      }
      .reset-btn {
        background-color: #6c757d;
      }
      .reset-btn:hover {
        background-color: #5a6268;
      }
      .result {
        margin-top: 25px;
        font-size: 20px;
        color: #28a745;
        font-weight: 600;
        min-height: 25px;
      }
      .footer {
        width: 100%;
        text-align: center;
        color: #777;
        margin-top: auto;
        padding: 20px;
      }

      /* Styles for Kalkulator BPJS */
      .radio-group {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin-top: 5px;
      }
      .radio-group div {
        display: flex;
        align-items: center;
      }
      .radio-group input[type="radio"] {
        margin-right: 10px;
        width: 16px;
        height: 16px;
      }

      /* Styles for Dynamic Calculator */
      #dynamic-inputs-container {
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      .input-row {
        display: flex;
        align-items: center;
        width: 100%;
        margin: 5px 0;
      }
      .line-number {
        font-family: monospace;
        width: 30px;
        text-align: right;
        padding-right: 10px;
        color: #6c757d;
      }
      input.value-input {
        flex-grow: 1;
      }

      /* Styles for Electricity Calculator */
      .radio-option {
        display: flex;
        align-items: center;
        margin-bottom: 5px;
      }
      .radio-option input {
        margin-right: 10px;
      }
      #hasilListrik {
        min-height: 25px;
      }

      /* Styles for Water Calculator */
      .mode-group {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-bottom: 20px;
      }
      .mode-group label {
        display: flex;
        align-items: center;
      }
      .radio-item {
        display: flex;
        align-items: center;
        background-color: #f9f9f9;
        padding: 10px;
        border-radius: 5px;
        border: 1px solid #ddd;
        cursor: pointer;
        transition: background-color 0.2s, border-color 0.2s;
        width: 100%;
      }
      .radio-item:hover {
        background-color: #f0f0f0;
        border-color: #bbb;
      }
      .radio-item input[type="radio"] {
        margin-right: 10px;
        transform: scale(1.2);
      }

      /* Styles for Kalkulator Biaya Sekolah (SPP) from index1.html */
      .result-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }
      .result-table th,
      .result-table td {
        border: 1px solid #ddd;
        padding: 10px;
        text-align: left;
      }
      .result-table th {
        background-color: #f2f2f2;
        color: #555;
      }
      #totalBiaya-tahun,
      #totalBiaya-triwulan,
      #totalBiaya-bulan {
        font-weight: bold;
        color: #28a745;
      }
      .input-group label {
        flex-basis: 150px;
        color: #333;
      }
      .input-group input[type="number"] {
        flex-grow: 1;
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 5px;
      }

      /* Styles for Kalkulator KJP Plus from index2.html */
      .radio-options {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .radio-options label {
        cursor: pointer;
        margin: 0;
        flex-basis: auto;
      }

      .radio-options input[type="radio"] {
        margin-right: 5px;
      }

      #tabel-perhitungan {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }

      #tabel-perhitungan th,
      #tabel-perhitungan td {
        border: 1px solid #ddd;
        padding: 10px;
        text-align: left;
      }

      #tabel-perhitungan th {
        background-color: #f2f2f2;
        color: #333;
      }

      #tabel-perhitungan tr:nth-child(even) {
        background-color: #f9f9f9;
      }

      .total-row {
        font-weight: bold;
        background-color: #e6f7ff !important;
      }

      /* START: Perbaikan Mobile (added by Gemini) */
      @media (max-width: 768px) {
        .calculators-container {
          flex-direction: column;
          gap: 20px;
          padding: 0 10px; /* Menambahkan padding horizontal pada kontainer utama */
        }
        .calculator-section {
          width: 100%;
          padding: 20px; /* Menyesuaikan padding untuk tampilan mobile */
          box-sizing: border-box;
          flex-basis: auto;
        }
      }
      /* END: Perbaikan Mobile */
    </style>
  </head>
  <body>
    <img src="logo.png" alt="Logo Perusahaan" class="logo" />
    <h1 class="main-header">KALKULATOR SUSENAS</h1>

    <div class="calculators-container">
      <div class="calculator-section">
        <h2>Kalkulator Usia</h2>
        <div class="input-group">
          <label for="birthdate">Masukkan Tanggal Lahir:</label>
          <input type="date" id="birthdate" />
        </div>
        <div class="button-group">
          <button id="calculateBtn">Hitung Usia</button>
          <button id="resetAgeBtn" class="reset-btn">Reset</button>
        </div>
        <div id="resultAge" class="result"></div>
      </div>

      <div class="calculator-section">
        <h2>Kalkulator Iuran Bulanan BPJS</h2>
        <div class="form-group">
          <label for="jumlahOrangBPJS">Jumlah Orang:</label>
          <input
            type="number"
            id="jumlahOrangBPJS"
            min="1"
            step="1"
            oninput="this.value = Math.floor(this.value);"
            value="0"
          />
        </div>
        <div class="form-group">
          <label>Pilihan Kelas:</label>
          <div class="radio-group">
            <div>
              <input type="radio" id="pbi" name="kelas" value="pbi" />
              <label for="pbi">PBI (Rp42.000)</label>
            </div>
            <div>
              <input type="radio" id="kelas1" name="kelas" value="kelas1" />
              <label for="kelas1">Mandiri Kelas I (Rp150.000)</label>
            </div>
            <div>
              <input type="radio" id="kelas2" name="kelas" value="kelas2" />
              <label for="kelas2">Mandiri Kelas II (Rp100.000)</label>
            </div>
            <div>
              <input type="radio" id="kelas3" name="kelas" value="kelas3" />
              <label for="kelas3">Mandiri Kelas III (Rp35.000)</label>
            </div>
          </div>
        </div>
        <div class="button-group">
          <button id="hitungBPJSBtn">Hitung</button>
          <button id="resetBPJSBtn" class="reset-btn">Reset</button>
        </div>
        <div class="result">
          <p>Total iuran bulanan BPJS yang harus dibayarkan:</p>
          <h3 id="totalBayarBPJS">Rp0</h3>
        </div>
        <div class="result">
          <p>Total iuran tahunan BPJS yang harus dibayarkan:</p>
          <h3 id="totalBayarBPJStahunan">Rp0</h3>
        </div>
      </div>

      <div class="calculator-section">
        <h2>Kalkulator Listrik</h2>
        <div class="form-group">
          <label>Pilih Mode Perhitungan</label>
          <div class="radio-group">
            <div class="radio-option">
              <input type="radio" name="modeListrik" value="hitungKWH" id="modeKWH" checked />
              <label for="modeKWH">Hitung kWh (dari Rupiah)</label>
            </div>
            <div class="radio-option">
              <input type="radio" name="modeListrik" value="hitungRupiah" id="modeRupiah" />
              <label for="modeRupiah">Hitung Rupiah (dari kWh)</label>
            </div>
          </div>
        </div>
        <div class="form-group" id="inputRupiah">
          <label for="jumlahRupiah">Jumlah yang Dibayarkan (Rp)</label>
          <input type="text" id="jumlahRupiah" placeholder="Masukkan jumlah uang" />
        </div>
        <div class="form-group" id="inputKWH" style="display: none">
          <label for="jumlahKWH">Jumlah kWh Pemakaian</label>
          <input type="text" id="jumlahKWH" placeholder="Masukkan jumlah kWh" />
        </div>
        <div class="form-group">
          <label>Daya yang terpasang</label>
          <div class="radio-group">
            <div class="radio-option">
              <input type="radio" name="dayaListrik" value="1352" id="daya1" />
              <label for="daya1">R-1/TR 900 VA-RTM</label>
            </div>
            <div class="radio-option">
              <input type="radio" name="dayaListrik" value="1444.70" id="daya2" />
              <label for="daya2">R-1/TR 1.300 VA</label>
            </div>
            <div class="radio-option">
              <input type="radio" name="dayaListrik" value="1444.70" id="daya3" />
              <label for="daya3">R-1/TR 2.200 VA</label>
            </div>
            <div class="radio-option">
              <input type="radio" name="dayaListrik" value="1699.53" id="daya4" />
              <label for="daya4">R-2/TR 3.500 VA s.d. 5.500 VA</label>
            </div>
            <div class="radio-option">
              <input type="radio" name="dayaListrik" value="1699.53" id="daya5" />
              <label for="daya5">R-3/TR, TM 6.600 VA ke atas</label>
            </div>
            <div class="radio-option">
              <input type="radio" name="dayaListrik" value="1444.70" id="daya6" />
              <label for="daya6">B-2/TR 6.600 VA s.d. 200 kVA</label>
            </div>
            <div class="radio-option">
              <input type="radio" name="dayaListrik" value="1035.78" id="daya7" />
              <label for="daya7">I-3/TM di atas 200 kVA</label>
            </div>
            <div class="radio-option">
              <input type="radio" name="dayaListrik" value="996.74" id="daya8" />
              <label for="daya8">I-4/TT 30.000 kVA ke atas</label>
            </div>
            <div class="radio-option">
              <input type="radio" name="dayaListrik" value="1699.53" id="daya10" />
              <label for="daya10">P-1/TR 6.600 VA s.d. 200 kVA</label>
            </div>
            <div class="radio-option">
              <input type="radio" name="dayaListrik" value="1415.01" id="daya11" />
              <label for="daya11">P-2/TM di atas 200 kVA</label>
            </div>
            <div class="radio-option">
              <input type="radio" name="dayaListrik" value="1699.53" id="daya12" />
              <label for="daya12">P-3/TR</label>
            </div>
            <div class="radio-option">
              <input type="radio" name="dayaListrik" value="1644.52" id="daya13" />
              <label for="daya13">L/TR, TM, TT</label>
            </div>
          </div>
        </div>
        <div class="button-group">
          <button id="hitungListrikBtn">Hitung</button>
          <button id="resetListrikBtn" class="reset-btn">Reset</button>
        </div>
        <div class="result" id="hasilListrik"></div>
      </div>

      <div class="calculator-section">
        <h2>Kalkulator Tagihan Air</h2>
        <div class="form-group">
          <div class="mode-group">
            <label
              ><input type="radio" name="modeAir" value="rupiah-to-m3" checked />
              Rupiah ke m³</label
            >
            <label
              ><input type="radio" name="modeAir" value="m3-to-rupiah" /> m³ ke
              Rupiah</label
            >
          </div>
        </div>
        <div id="rupiahInputGroup" class="form-group">
          <label for="rupiahInput">Jumlah Tagihan (Rupiah):</label>
          <input
            type="text"
            id="rupiahInput"
            placeholder="Contoh: 50.000"
            required
          />
        </div>
        <div id="m3InputGroup" class="form-group" style="display: none">
          <label for="m3Input">Penggunaan Air (m³):</label>
          <input
            type="text"
            id="m3Input"
            placeholder="Contoh: 15,5"
            required
          />
        </div>
        <div class="form-group">
          <label>Pilih Kelompok Pelanggan:</label>
          <div class="radio-group">
            <label class="radio-item"
              ><input type="radio" name="kelompok" value="KI" /> 1. KI
              (Bangunan Sosial, Hidran Kebakaran, dll)</label
            >
            <label class="radio-item"
              ><input type="radio" name="kelompok" value="rsh" /> 2. Rumah Susun
              Sangat Sederhana</label
            >
            <label class="radio-item"
              ><input type="radio" name="kelompok" value="rts1" /> 3. Rumah
              Tangga Sangat Sederhana II</label
            >
            <label class="radio-item"
              ><input type="radio" name="kelompok" value="rssp" /> 4. Rumah
              Susun Sederhana Sewa-Pemerintah</label
            >
            <label class="radio-item"
              ><input type="radio" name="kelompok" value="rts2" /> 5. Rumah
              Tangga Sederhana I</label
            >
            <label class="radio-item"
              ><input type="radio" name="kelompok" value="rts3" /> 6. Rumah
              Tangga Sederhana II</label
            >
            <label class="radio-item"
              ><input type="radio" name="kelompok" value="rtm1" /> 7. Rumah
              Tangga Menengah I</label
            >
            <label class="radio-item"
              ><input type="radio" name="kelompok" value="rtm2" /> 8. Rumah
              Tangga Menengah II</label
            >
            <label class="radio-item"
              ><input type="radio" name="kelompok" value="rtam1" /> 9. Rumah
              Tangga Di Atas Menengah I</label
            >
            <label class="radio-item"
              ><input type="radio" name="kelompok" value="rtam2" /> 10. Rumah
              Tangga Di Atas Menengah II</label
            >
          </div>
        </div>
        <div class="button-group">
          <button id="hitungAirBtn">Hitung</button>
          <button id="resetAirBtn" class="reset-btn">Reset</button>
        </div>
        <div id="hasilAir" class="result"></div>
      </div>

      <div class="calculator-section">
        <h2>Kalkulator Biaya Sekolah (SPP)</h2>
        <p>Masukkan jumlah anak sesuai jenjang pendidikan:</p>

        <div class="input-group">
          <label for="sd">Jumlah Anak SD:</label>
          <input
            type="number"
            id="sd"
            value="0"
            min="0"
            oninput="validateAndFix(this)"
          />
        </div>
        <div class="input-group">
          <label for="smp">Jumlah Anak SMP:</label>
          <input
            type="number"
            id="smp"
            value="0"
            min="0"
            oninput="validateAndFix(this)"
          />
        </div>
        <div class="input-group">
          <label for="sma">Jumlah Anak SMA:</label>
          <input
            type="number"
            id="sma"
            value="0"
            min="0"
            oninput="validateAndFix(this)"
          />
        </div>
        <div class="input-group">
          <label for="smk">Jumlah Anak SMK:</label>
          <input
            type="number"
            id="smk"
            value="0"
            min="0"
            oninput="validateAndFix(this)"
          />
        </div>
        <div class="input-group">
          <label for="slb">Jumlah Anak SLB:</label>
          <input
            type="number"
            id="slb"
            value="0"
            min="0"
            oninput="validateAndFix(this)"
          />
        </div>

        <div class="button-group">
          <button id="hitungSPP">Hitung</button>
          <button id="resetSPP" class="reset-btn">Reset</button>
        </div>

        <hr />

        <h2>Hasil Perhitungan</h2>
        <table class="result-table">
          <thead>
            <tr>
              <th>Jenjang Pendidikan</th>
              <th>Jumlah Anak</th>
              <th>Biaya per Bulan</th>
              <th>Biaya per Triwulan</th>
              <th>Biaya per Tahun</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>SD</td>
              <td id="sd-jumlah">0</td>
              <td id="sd-total-bulan">Rp 0</td>
              <td id="sd-total-triwulan">Rp 0</td>
              <td id="sd-total-tahun">Rp 0</td>
            </tr>
            <tr>
              <td>SMP</td>
              <td id="smp-jumlah">0</td>
              <td id="smp-total-bulan">Rp 0</td>
              <td id="smp-total-triwulan">Rp 0</td>
              <td id="smp-total-tahun">Rp 0</td>
            </tr>
            <tr>
              <td>SMA</td>
              <td id="sma-jumlah">0</td>
              <td id="sma-total-bulan">Rp 0</td>
              <td id="sma-total-triwulan">Rp 0</td>
              <td id="sma-total-tahun">Rp 0</td>
            </tr>
            <tr>
              <td>SMK</td>
              <td id="smk-jumlah">0</td>
              <td id="smk-total-bulan">Rp 0</td>
              <td id="smk-total-triwulan">Rp 0</td>
              <td id="smk-total-tahun">Rp 0</td>
            </tr>
            <tr>
              <td>SLB</td>
              <td id="slb-jumlah">0</td>
              <td id="slb-total-bulan">Rp 0</td>
              <td id="slb-total-triwulan">Rp 0</td>
              <td id="slb-total-tahun">Rp 0</td>
            </tr>
            <tr>
              <td colspan="2"><b>TOTAL KESELURUHAN</b></td>
              <td id="totalBiaya-bulan">Rp 0</td>
              <td id="totalBiaya-triwulan">Rp 0</td>
              <td id="totalBiaya-tahun">Rp 0</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="calculator-section">
        <h2>Kalkulator KJP Plus</h2>
        <p>
          Silakan masukkan jumlah anak di setiap jenjang pendidikan dan pilih
          jenis sekolah.
        </p>

        <form id="kjp-form">
          <div class="input-group">
            <label for="sdKJP">Jumlah Anak SD/MI:</label>
            <input
              type="number"
              id="sdKJP"
              value="0"
              min="0"
              oninput="validateInput(this)"
            />
            <div class="radio-options">
              <input
                type="radio"
                id="sd-negeri"
                name="sekolah-sd"
                value="negeri"
                checked
              />
              <label for="sd-negeri">Negeri</label>
              <input
                type="radio"
                id="sd-swasta"
                name="sekolah-sd"
                value="swasta"
              />
              <label for="sd-swasta">Swasta</label>
            </div>
          </div>

          <div class="input-group">
            <label for="smpKJP">Jumlah Anak SMP/MTs:</label>
            <input
              type="number"
              id="smpKJP"
              value="0"
              min="0"
              oninput="validateInput(this)"
            />
            <div class="radio-options">
              <input
                type="radio"
                id="smp-negeri"
                name="sekolah-smp"
                value="negeri"
                checked
              />
              <label for="smp-negeri">Negeri</label>
              <input
                type="radio"
                id="smp-swasta"
                name="sekolah-smp"
                value="swasta"
              />
              <label for="smp-swasta">Swasta</label>
            </div>
          </div>

          <div class="input-group">
            <label for="smaKJP">Jumlah Anak SMA/MA:</label>
            <input
              type="number"
              id="smaKJP"
              value="0"
              min="0"
              oninput="validateInput(this)"
            />
            <div class="radio-options">
              <input
                type="radio"
                id="sma-negeri"
                name="sekolah-sma"
                value="negeri"
                checked
              />
              <label for="sma-negeri">Negeri</label>
              <input
                type="radio"
                id="sma-swasta"
                name="sekolah-sma"
                value="swasta"
              />
              <label for="sma-swasta">Swasta</label>
            </div>
          </div>

          <div class="input-group">
            <label for="smkKJP">Jumlah Anak SMK:</label>
            <input
              type="number"
              id="smkKJP"
              value="0"
              min="0"
              oninput="validateInput(this)"
            />
            <div class="radio-options">
              <input
                type="radio"
                id="smk-negeri"
                name="sekolah-smk"
                value="negeri"
                checked
              />
              <label for="smk-negeri">Negeri</label>
              <input
                type="radio"
                id="smk-swasta"
                name="sekolah-smk"
                value="swasta"
              />
              <label for="smk-swasta">Swasta</label>
            </div>
          </div>

          <div class="input-group">
            <label for="pkbmKJP">Jumlah Anak PKBM:</label>
            <input
              type="number"
              id="pkbmKJP"
              value="0"
              min="0"
              oninput="validateInput(this)"
            />
          </div>

          <div class="button-group">
            <button type="button" id="hitungKJP">Hitung</button>
            <button type="button" id="resetKJP" class="reset-btn">Reset</button>
          </div>
        </form>

        <table id="tabel-perhitungan">
          <thead>
            <tr>
              <th>Jenjang</th>
              <th>Jumlah Anak</th>
              <th>Dana Per Bulan</th>
              <th>Dana Per Triwulan</th>
              <th>Dana Per Tahun</th>
            </tr>
          </thead>
          <tbody id="tabel-body"></tbody>
          <tfoot>
            <tr class="total-row">
              <td colspan="2">TOTAL KESELURUHAN</td>
              <td id="total-per-bulan"></td>
              <td id="total-per-triwulan"></td>
              <td id="total-per-tahun"></td>
            </tr>
          </tfoot>
        </table>
      </div>

      <div class="calculator-section">
        <h2>Kalkulator Penjumlahan Dinamis</h2>
        <div id="dynamic-inputs-container">
          <div class="input-row">
            <span class="line-number">1.</span>
            <input
              type="text"
              class="value-input"
              placeholder="Masukkan nilai..."
            />
          </div>
        </div>
        <div class="button-group">
          <button id="resetDynamicBtn" class="reset-btn">Reset</button>
        </div>
        <div class="result">
          <p>
            Total Nilai: <span id="total-sum-dynamic">0</span>
          </p>
        </div>
      </div>
    </div>

    <div class="button-group" style="margin-top: 40px">
      <button id="resetAllBtn" class="reset-btn">Reset Semua Kalkulator</button>
    </div>

    <footer class="footer">BPS Kota Jakarta Barat Jaya Jaya Jaya</footer>

    <script>
      // --- Kalkulator Usia ---
      const birthdateInput = document.getElementById("birthdate");
      const calculateAgeBtn = document.getElementById("calculateBtn");
      const resetAgeBtn = document.getElementById("resetAgeBtn");
      const resultAgeDiv = document.getElementById("resultAge");

      birthdateInput.addEventListener("keypress", (e) => {
        if (e.key === "Enter" || e.keyCode === 13) {
          e.preventDefault();
          calculateAge();
        }
      });

      function calculateAge() {
        const birthdateValue = birthdateInput.value;
        if (!birthdateValue) {
          resultAgeDiv.textContent = "Masukkan tanggal lahir.";
          resultAgeDiv.style.color = "#dc3545";
          return;
        }

        const birthdate = new Date(birthdateValue);
        const today = new Date();
        let years = today.getFullYear() - birthdate.getFullYear();
        let months = today.getMonth() - birthdate.getMonth();
        let days = today.getDate() - birthdate.getDate();

        if (days < 0) {
          months--;
          const prevMonth = today.getMonth() === 0 ? 11 : today.getMonth() - 1;
          const prevYear =
            today.getMonth() === 0 ? today.getFullYear() - 1 : today.getFullYear();
          days += new Date(prevYear, prevMonth + 1, 0).getDate();
        }
        if (months < 0) {
          years--;
          months += 12;
        }

        resultAgeDiv.textContent = `Usia ${years} tahun, ${months} bulan, dan ${days} hari.`;
        resultAgeDiv.style.color = "#28a745";
      }

      function resetAgeForm() {
        birthdateInput.value = "";
        resultAgeDiv.textContent = "";
        resultAgeDiv.style.color = "#28a745";
      }
      calculateAgeBtn.addEventListener("click", calculateAge);
      resetAgeBtn.addEventListener("click", resetAgeForm);

      // --- Kalkulator BPJS ---
      const hitungBPJSBtn = document.getElementById("hitungBPJSBtn");
      const resetBPJSBtn = document.getElementById("resetBPJSBtn");
      const jumlahOrangBPJSInput = document.getElementById("jumlahOrangBPJS");
      const totalBayarBPJS = document.getElementById("totalBayarBPJS");
      const totalBayarBPJStahunan = document.getElementById(
        "totalBayarBPJStahunan"
      );

      jumlahOrangBPJSInput.addEventListener("input", function (e) {
        let value = e.target.value;
        if (value.includes(".") || value.includes(",")) {
          alert("Input jumlah orang harus berupa angka bulat.");
          e.target.value = Math.floor(value);
        }
      });

      const biayaPerKelas = {
        pbi: 42000,
        kelas1: 150000,
        kelas2: 100000,
        kelas3: 35000,
      };

      hitungBPJSBtn.addEventListener("click", () => {
        const jumlahOrang = parseInt(jumlahOrangBPJSInput.value);
        const kelasDipilih = document.querySelector('input[name="kelas"]:checked');

        if (isNaN(jumlahOrang) || jumlahOrang <= 0) {
          alert("Masukkan jumlah orang yang valid (hanya angka dan lebih dari 0).");
          totalBayarBPJS.textContent = "Rp0";
          totalBayarBPJStahunan.textContent = "Rp0";
          return;
        }

        if (!kelasDipilih) {
          alert("Mohon pilih salah satu kelas BPJS.");
          totalBayarBPJS.textContent = "Rp0";
          totalBayarBPJStahunan.textContent = "Rp0";
          return;
        }

        const totalBiayaBulanan = jumlahOrang * biayaPerKelas[kelasDipilih.value];
        const totalBiayaTahunan = totalBiayaBulanan * 12;

        totalBayarBPJS.textContent = `Rp${totalBiayaBulanan.toLocaleString(
          "id-ID"
        )}`;
        totalBayarBPJStahunan.textContent = `Rp${totalBiayaTahunan.toLocaleString(
          "id-ID"
        )}`;
      });

      resetBPJSBtn.addEventListener("click", () => {
        jumlahOrangBPJSInput.value = 1;
        const radios = document.getElementsByName("kelas");
        radios.forEach((radio) => (radio.checked = false));
        totalBayarBPJS.textContent = "Rp0";
        totalBayarBPJStahunan.textContent = "Rp0";
      });

      // --- Kalkulator Listrik ---
      const modeRadiosListrik = document.getElementsByName("modeListrik");
      const hitungListrikBtn = document.getElementById("hitungListrikBtn");
      const resetListrikBtn = document.getElementById("resetListrikBtn");
      const inputRupiahDiv = document.getElementById("inputRupiah");
      const inputKWHDiv = document.getElementById("inputKWH");
      const jumlahRupiahInput = document.getElementById("jumlahRupiah");
      const jumlahKWHInput = document.getElementById("jumlahKWH");
      const hasilListrikDiv = document.getElementById("hasilListrik");

      jumlahKWHInput.addEventListener("input", function (e) {
        const input = e.target;
        let value = input.value.replace(/\./g, ",");
        const originalValue = input.value;
        const newValue = value.replace(/[^0-9,]/g, "");
        if (newValue !== originalValue) {
          alert("Input hanya boleh berupa angka dan koma.");
        }
        const parts = newValue.split(",");
        if (parts.length > 2) {
          value = parts[0] + "," + parts.slice(1).join("");
        }
        input.value = value;
      });

      function formatRupiah(input) {
        let number_string = input.value.replace(/\./g, "").toString();
        let split = number_string.split(",");
        let sisa = split[0].length % 3;
        let rupiah = split[0].substr(0, sisa);
        let ribuan = split[0].substr(sisa).match(/\d{3}/gi);
        if (ribuan) {
          separator = sisa ? "." : "";
          rupiah += separator + ribuan.join(".");
        }
        rupiah = split[1] !== undefined ? rupiah + "," + split[1] : rupiah;
        input.value = rupiah;
      }

      function hitungListrik() {
        const mode = document.querySelector('input[name="modeListrik"]:checked')
          .value;
        hasilListrikDiv.innerHTML = "";
        let hargaPerKWH = 0;
        const radioButtonsDaya = document.getElementsByName("dayaListrik");
        for (const radio of radioButtonsDaya) {
          if (radio.checked) {
            hargaPerKWH = parseFloat(radio.value);
            break;
          }
        }
        if (hargaPerKWH === 0) {
          hasilListrikDiv.innerHTML = "⚠️ Mohon pilih daya yang digunakan.";
          return;
        }
        if (mode === "hitungKWH") {
          const jumlahRupiahRaw = jumlahRupiahInput.value;
          const jumlahRupiah = parseFloat(
            jumlahRupiahRaw.replace(/\./g, "").replace(/,/g, ".")
          );
          if (isNaN(jumlahRupiah) || jumlahRupiah <= 0) {
            hasilListrikDiv.innerHTML =
              "⚠️ Mohon masukkan jumlah uang yang valid.";
            return;
          }
          const kwh = jumlahRupiah / hargaPerKWH;
          hasilListrikDiv.innerHTML = `Konsumsi kWh adalah: <br> ${kwh.toLocaleString(
            "id-ID",
            { minimumFractionDigits: 2, maximumFractionDigits: 2 }
          )} kWh`;
        } else {
          const jumlahKWH = parseFloat(jumlahKWHInput.value.replace(/,/g, "."));
          if (isNaN(jumlahKWH) || jumlahKWH <= 0) {
            hasilListrikDiv.innerHTML = "⚠️ Mohon masukkan jumlah kWh yang valid.";
            return;
          }
          const totalRupiah = jumlahKWH * hargaPerKWH;
          hasilListrikDiv.innerHTML = `Jumlah Rupiah yang harus dibayarkan adalah: <br> Rp ${totalRupiah.toLocaleString(
            "id-ID",
            { minimumFractionDigits: 2, maximumFractionDigits: 2 }
          )}`;
        }
      }

      function refreshListrik() {
        jumlahRupiahInput.value = "";
        jumlahKWHInput.value = "";
        hasilListrikDiv.innerHTML = "";
        const radioButtonsDaya = document.getElementsByName("dayaListrik");
        for (const radio of radioButtonsDaya) {
          radio.checked = false;
        }
        document.getElementById("modeKWH").checked = true;
        inputRupiahDiv.style.display = "block";
        inputKWHDiv.style.display = "none";
      }

      hitungListrikBtn.addEventListener("click", hitungListrik);
      resetListrikBtn.addEventListener("click", refreshListrik);
      jumlahRupiahInput.addEventListener("keyup", () =>
        formatRupiah(jumlahRupiahInput)
      );

      for (const radio of modeRadiosListrik) {
        radio.addEventListener("change", (e) => {
          if (e.target.value === "hitungRupiah") {
            inputRupiahDiv.style.display = "none";
            inputKWHDiv.style.display = "block";
          } else {
            inputRupiahDiv.style.display = "block";
            inputKWHDiv.style.display = "none";
          }
          hasilListrikDiv.innerHTML = "";
        });
      }

      // --- Kalkulator Air ---
      const tarifAir = {
        KI: [1000, 1500, 1700],
        rsh: [1000, 2000, 3000],
        rts1: [1500, 3000, 5550],
        rssp: [1050, 7450, 7450],
        rts2: [3550, 6750, 7500],
        rts3: [4000, 7500, 9500],
        rtm1: [4900, 9500, 12500],
        rtm2: [6000, 10500, 14000],
        rtam1: [6825, 12500, 17500],
        rtam2: [8600, 15000, 20000],
      };

      const hitungAirBtn = document.getElementById("hitungAirBtn");
      const resetAirBtn = document.getElementById("resetAirBtn");
      const modeRadiosAir = document.getElementsByName("modeAir");
      const rupiahAirInput = document.getElementById("rupiahInput");
      const m3AirInput = document.getElementById("m3Input");
      const rupiahAirGroup = document.getElementById("rupiahInputGroup");
      const m3AirGroup = document.getElementById("m3InputGroup");
      const hasilAirDiv = document.getElementById("hasilAir");
      const kelompokRadiosAir = document.getElementsByName("kelompok");

      rupiahAirInput.addEventListener("keyup", function (e) {
        let input = e.target.value;
        const formattedInput = input.replace(/[^0-9.]/g, ""); // Hapus semua karakter selain angka dan titik

        // Hapus titik ganda
        let parts = formattedInput.split(".");
        if (parts.length > 2) {
          input = parts[0] + "." + parts.slice(1).join("");
        }

        // Hapus pemisah ribuan dan format ulang
        let number_string = input.replace(/\./g, "").toString();
        let split = number_string.split(",");
        let sisa = split[0].length % 3;
        let rupiah = split[0].substr(0, sisa);
        let ribuan = split[0].substr(sisa).match(/\d{3}/gi);
        if (ribuan) {
          separator = sisa ? "." : "";
          rupiah += separator + ribuan.join(".");
        }
        rupiah = split[1] !== undefined ? rupiah + "," + split[1] : rupiah;
        e.target.value = rupiah;
      });

      m3AirInput.addEventListener("input", function (e) {
        const input = e.target;
        let value = input.value.replace(/\./g, ",");
        const originalValue = input.value;
        const newValue = value.replace(/[^0-9,]/g, "");
        if (newValue !== originalValue) {
          alert("Input hanya boleh berupa angka dan koma.");
        }
        const parts = newValue.split(",");
        if (parts.length > 2) {
          value = parts[0] + "," + parts.slice(1).join("");
        }
        input.value = value;
      });

      function hitungRupiahKeM3(totalRupiah, tarifKelompok) {
        let penggunaanAir = 0;
        let sisaRupiah = totalRupiah;

        const tier1_biaya = 10 * tarifKelompok[0];
        const tier2_biaya = 10 * tarifKelompok[1];

        if (sisaRupiah > 0) {
          if (sisaRupiah >= tier1_biaya) {
            penggunaanAir += 10;
            sisaRupiah -= tier1_biaya;
          } else {
            penggunaanAir += sisaRupiah / tarifKelompok[0];
            sisaRupiah = 0;
          }
        }

        if (sisaRupiah > 0) {
          if (sisaRupiah >= tier2_biaya) {
            penggunaanAir += 10;
            sisaRupiah -= tier2_biaya;
          } else {
            penggunaanAir += sisaRupiah / tarifKelompok[1];
            sisaRupiah = 0;
          }
        }

        if (sisaRupiah > 0) {
          penggunaanAir += sisaRupiah / tarifKelompok[2];
        }

        return penggunaanAir.toLocaleString("id-ID", {
          minimumFractionDigits: 2,
          maximumFractionDigits: 2,
        });
      }

      function hitungM3KeRupiah(totalM3, tarifKelompok) {
        let totalRupiah = 0;
        let sisaM3 = totalM3;

        if (sisaM3 > 0) {
          if (sisaM3 > 20) {
            totalRupiah += (sisaM3 - 20) * tarifKelompok[2];
            sisaM3 = 20;
          }
          if (sisaM3 > 10) {
            totalRupiah += (sisaM3 - 10) * tarifKelompok[1];
            sisaM3 = 10;
          }
          if (sisaM3 > 0) {
            totalRupiah += sisaM3 * tarifKelompok[0];
          }
        }
        return totalRupiah;
      }

      function hitungAir() {
        const mode = document.querySelector('input[name="modeAir"]:checked')
          .value;
        const selectedRadio = document.querySelector(
          'input[name="kelompok"]:checked'
        );

        if (!selectedRadio) {
          hasilAirDiv.innerHTML = "⚠️ Pilih salah satu kelompok pelanggan.";
          return;
        }

        const kelompok = selectedRadio.value;
        const namaKelompok = selectedRadio.parentElement.textContent.trim();
        const tarifKelompok = tarifAir[kelompok];

        if (mode === "rupiah-to-m3") {
          const inputValue = rupiahAirInput.value
            .replace(/\./g, "")
            .replace(/,/g, ".");
          const totalRupiah = parseFloat(inputValue);

          if (isNaN(totalRupiah) || totalRupiah <= 0) {
            hasilAirDiv.innerHTML =
              "⚠️ Masukkan jumlah tagihan yang valid (hanya angka positif).";
            return;
          }

          const penggunaanAir = hitungRupiahKeM3(totalRupiah, tarifKelompok);
          hasilAirDiv.innerHTML = `Jumlah tagihan Anda adalah **Rp ${totalRupiah.toLocaleString(
            "id-ID"
          )}**.<br>
                                 Berdasarkan tarif **${namaKelompok}**, perkiraan penggunaan air Anda adalah sekitar **${penggunaanAir} meter kubik**.<br>`;
        } else {
          const totalM3 = parseFloat(m3AirInput.value.replace(/,/g, "."));

          if (isNaN(totalM3) || totalM3 <= 0) {
            hasilAirDiv.innerHTML =
              "⚠️ Masukkan jumlah penggunaan air yang valid (angka positif).";
            return;
          }

          const totalRupiah = hitungM3KeRupiah(totalM3, tarifKelompok);
          hasilAirDiv.innerHTML = `Penggunaan air Anda adalah **${totalM3.toLocaleString(
            "id-ID"
          )} meter kubik**.<br>
                                 Berdasarkan tarif **${namaKelompok}**, perkiraan jumlah tagihan Anda adalah sekitar **Rp ${totalRupiah.toLocaleString(
            "id-ID"
          )}**.<br>`;
        }
      }

      function resetAirForm() {
        rupiahAirInput.value = "";
        m3AirInput.value = "";
        for (const radio of kelompokRadiosAir) {
          radio.checked = false;
        }
        document.querySelector('input[name="modeAir"][value="rupiah-to-m3"]').checked = true;
        toggleAirInputs();
        hasilAirDiv.innerHTML = "";
      }

      function toggleAirInputs() {
        const mode = document.querySelector('input[name="modeAir"]:checked')
          .value;
        if (mode === "rupiah-to-m3") {
          rupiahAirGroup.style.display = "block";
          m3AirGroup.style.display = "none";
        } else {
          rupiahAirGroup.style.display = "none";
          m3AirGroup.style.display = "block";
        }
        hasilAirDiv.innerHTML = "";
      }

      for (const radio of modeRadiosAir) {
        radio.addEventListener("change", toggleAirInputs);
      }

      hitungAirBtn.addEventListener("click", hitungAir);
      resetAirBtn.addEventListener("click", resetAirForm);

      // --- Kalkulator Biaya Sekolah (SPP) ---
      function validateAndFix(input) {
        let value = input.value;
        value = value.replace(/[^0-9]/g, "");

        if (value.length > 1 && value.startsWith("0")) {
          value = parseInt(value, 10).toString();
        }

        input.value = value;
      }
      document.getElementById("hitungSPP").addEventListener("click", function () {
        const sd_anak = parseInt(document.getElementById("sd").value) || 0;
        const smp_anak = parseInt(document.getElementById("smp").value) || 0;
        const sma_anak = parseInt(document.getElementById("sma").value) || 0;
        const smk_anak = parseInt(document.getElementById("smk").value) || 0;
        const slb_anak = parseInt(document.getElementById("slb").value) || 0;

        const biaya_sd = 1010000;
        const biaya_smp = 1240000;
        const biaya_sma = 1680000;
        const biaya_smk = 1800000;
        const biaya_slb = 3930000;

        const total_sd_tahun = sd_anak * biaya_sd;
        const total_smp_tahun = smp_anak * biaya_smp;
        const total_sma_tahun = sma_anak * biaya_sma;
        const total_smk_tahun = smk_anak * biaya_smk;
        const total_slb_tahun = slb_anak * biaya_slb;

        const total_sd_triwulan = total_sd_tahun / 4;
        const total_sd_bulan = total_sd_tahun / 12;

        const total_smp_triwulan = total_smp_tahun / 4;
        const total_smp_bulan = total_smp_tahun / 12;

        const total_sma_triwulan = total_sma_tahun / 4;
        const total_sma_bulan = total_sma_tahun / 12;

        const total_smk_triwulan = total_smk_tahun / 4;
        const total_smk_bulan = total_smk_tahun / 12;

        const total_slb_triwulan = total_slb_tahun / 4;
        const total_slb_bulan = total_slb_tahun / 12;

        const total_keseluruhan_tahun =
          total_sd_tahun +
          total_smp_tahun +
          total_sma_tahun +
          total_smk_tahun +
          total_slb_tahun;
        const total_keseluruhan_triwulan = total_keseluruhan_tahun / 4;
        const total_keseluruhan_bulan = total_keseluruhan_tahun / 12;

        document.getElementById("sd-jumlah").innerText = sd_anak;
        document.getElementById("smp-jumlah").innerText = smp_anak;
        document.getElementById("sma-jumlah").innerText = sma_anak;
        document.getElementById("smk-jumlah").innerText = smk_anak;
        document.getElementById("slb-jumlah").innerText = slb_anak;

        const formatRupiah = (angka) => {
          const formatter = new Intl.NumberFormat("id-ID", {
            style: "currency",
            currency: "IDR",
            minimumFractionDigits: 0,
          });
          return formatter.format(angka);
        };

        document.getElementById("sd-total-tahun").innerText =
          formatRupiah(total_sd_tahun);
        document.getElementById("sd-total-triwulan").innerText =
          formatRupiah(total_sd_triwulan);
        document.getElementById("sd-total-bulan").innerText =
          formatRupiah(total_sd_bulan);

        document.getElementById("smp-total-tahun").innerText =
          formatRupiah(total_smp_tahun);
        document.getElementById("smp-total-triwulan").innerText =
          formatRupiah(total_smp_triwulan);
        document.getElementById("smp-total-bulan").innerText =
          formatRupiah(total_smp_bulan);

        document.getElementById("sma-total-tahun").innerText =
          formatRupiah(total_sma_tahun);
        document.getElementById("sma-total-triwulan").innerText =
          formatRupiah(total_sma_triwulan);
        document.getElementById("sma-total-bulan").innerText =
          formatRupiah(total_sma_bulan);

        document.getElementById("smk-total-tahun").innerText =
          formatRupiah(total_smk_tahun);
        document.getElementById("smk-total-triwulan").innerText =
          formatRupiah(total_smk_triwulan);
        document.getElementById("smk-total-bulan").innerText =
          formatRupiah(total_smk_bulan);

        document.getElementById("slb-total-tahun").innerText =
          formatRupiah(total_slb_tahun);
        document.getElementById("slb-total-triwulan").innerText =
          formatRupiah(total_slb_triwulan);
        document.getElementById("slb-total-bulan").innerText =
          formatRupiah(total_slb_bulan);

        document.getElementById("totalBiaya-tahun").innerText =
          formatRupiah(total_keseluruhan_tahun);
        document.getElementById("totalBiaya-triwulan").innerText =
          formatRupiah(total_keseluruhan_triwulan);
        document.getElementById("totalBiaya-bulan").innerText =
          formatRupiah(total_keseluruhan_bulan);
      });

      document.getElementById("resetSPP").addEventListener("click", function () {
        document.getElementById("sd").value = 0;
        document.getElementById("smp").value = 0;
        document.getElementById("sma").value = 0;
        document.getElementById("smk").value = 0;
        document.getElementById("slb").value = 0;

        document.getElementById("sd-jumlah").innerText = "0";
        document.getElementById("smp-jumlah").innerText = "0";
        document.getElementById("sma-jumlah").innerText = "0";
        document.getElementById("smk-jumlah").innerText = "0";
        document.getElementById("slb-jumlah").innerText = "0";

        document.getElementById("sd-total-tahun").innerText = "Rp 0";
        document.getElementById("sd-total-triwulan").innerText = "Rp 0";
        document.getElementById("sd-total-bulan").innerText = "Rp 0";

        document.getElementById("smp-total-tahun").innerText = "Rp 0";
        document.getElementById("smp-total-triwulan").innerText = "Rp 0";
        document.getElementById("smp-total-bulan").innerText = "Rp 0";

        document.getElementById("sma-total-tahun").innerText = "Rp 0";
        document.getElementById("sma-total-triwulan").innerText = "Rp 0";
        document.getElementById("sma-total-bulan").innerText = "Rp 0";

        document.getElementById("smk-total-tahun").innerText = "Rp 0";
        document.getElementById("smk-total-triwulan").innerText = "Rp 0";
        document.getElementById("smk-total-bulan").innerText = "Rp 0";

        document.getElementById("slb-total-tahun").innerText = "Rp 0";
        document.getElementById("slb-total-triwulan").innerText = "Rp 0";
        document.getElementById("slb-total-bulan").innerText = "Rp 0";

        document.getElementById("totalBiaya-tahun").innerText = "Rp 0";
        document.getElementById("totalBiaya-triwulan").innerText = "Rp 0";
        document.getElementById("totalBiaya-bulan").innerText = "Rp 0";
      });

      // --- Kalkulator KJP Plus ---
      function validateInput(input) {
        let value = input.value;
        value = value.replace(/[^0-9]/g, "");

        if (value.length > 1 && value.startsWith("0")) {
          value = value.substring(1);
        }

        if (value === "" || parseInt(value) < 0) {
          input.value = "0";
        } else {
          input.value = value;
        }
      }

      const dataKJP = {
        sd: { label: "SD/MI", personal: 250000, sppSwasta: 130000 },
        smp: { label: "SMP/MTs", personal: 300000, sppSwasta: 170000 },
        sma: { label: "SMA/MA", personal: 420000, sppSwasta: 290000 },
        smk: { label: "SMK", personal: 450000, sppSwasta: 240000 },
        pkbm: { label: "PKBM", personal: 300000, sppSwasta: 0 },
      };

      function updateTableKJP() {
        let totalBulan = 0;
        let totalTriwulan = 0;
        let totalTahun = 0;
        const tabelBody = document.getElementById("tabel-body");
        tabelBody.innerHTML = "";

        const jenjangList = [
          {
            id: "sd",
            count: document.getElementById("sdKJP").value,
            school: document.querySelector('input[name="sekolah-sd"]:checked')
              .value,
          },
          {
            id: "smp",
            count: document.getElementById("smpKJP").value,
            school: document.querySelector('input[name="sekolah-smp"]:checked')
              .value,
          },
          {
            id: "sma",
            count: document.getElementById("smaKJP").value,
            school: document.querySelector('input[name="sekolah-sma"]:checked')
              .value,
          },
          {
            id: "smk",
            count: document.getElementById("smkKJP").value,
            school: document.querySelector('input[name="sekolah-smk"]:checked')
              .value,
          },
          {
            id: "pkbm",
            count: document.getElementById("pkbmKJP").value,
            school: "negeri",
          },
        ];

        jenjangList.forEach((item) => {
          const count = parseInt(item.count) || 0;
          let danaPerBulan = count * dataKJP[item.id].personal;
          let jenisSekolahLabel = "Negeri";

          if (item.school === "swasta") {
            danaPerBulan += count * dataKJP[item.id].sppSwasta;
            jenisSekolahLabel = "Swasta";
          }

          const danaPerTriwulan = danaPerBulan * 3;
          const danaPerTahun = danaPerBulan * 12;

          totalBulan += danaPerBulan;
          totalTriwulan += danaPerTriwulan;
          totalTahun += danaPerTahun;

          const row = `
                    <tr>
                        <td>${dataKJP[item.id].label} (${jenisSekolahLabel})</td>
                        <td>${count}</td>
                        <td>Rp ${danaPerBulan.toLocaleString("id-ID")}</td>
                        <td>Rp ${danaPerTriwulan.toLocaleString("id-ID")}</td>
                        <td>Rp ${danaPerTahun.toLocaleString("id-ID")}</td>
                    </tr>
                `;
          tabelBody.innerHTML += row;
        });

        document.getElementById("total-per-bulan").textContent = `Rp ${totalBulan.toLocaleString(
          "id-ID"
        )}`;
        document.getElementById("total-per-triwulan").textContent = `Rp ${totalTriwulan.toLocaleString(
          "id-ID"
        )}`;
        document.getElementById("total-per-tahun").textContent = `Rp ${totalTahun.toLocaleString(
          "id-ID"
        )}`;
      }

      function resetFormKJP() {
        document.getElementById("sdKJP").value = 0;
        document.getElementById("smpKJP").value = 0;
        document.getElementById("smaKJP").value = 0;
        document.getElementById("smkKJP").value = 0;
        document.getElementById("pkbmKJP").value = 0;

        document.getElementById("sd-negeri").checked = true;
        document.getElementById("smp-negeri").checked = true;
        document.getElementById("sma-negeri").checked = true;
        document.getElementById("smk-negeri").checked = true;

        updateTableKJP();
      }

      document.getElementById("hitungKJP").addEventListener("click", updateTableKJP);
      document.getElementById("resetKJP").addEventListener("click", resetFormKJP);
      document.addEventListener("DOMContentLoaded", updateTableKJP);

      // --- Kalkulator Dinamis ---
      const inputsContainer = document.getElementById("dynamic-inputs-container");
      const totalSumSpan = document.getElementById("total-sum-dynamic");
      const resetButtonDynamic = document.getElementById("resetDynamicBtn");

      const cleanNumber = (value) => value.replace(/\./g, "").replace(/,/g, ".");
      const formatNumber = (value) => {
        const cleanedValue = cleanNumber(value);
        if (!cleanedValue) return "";
        const parts = cleanedValue.split(".");
        const integerPart = parseInt(parts[0]).toLocaleString("id-ID");
        const decimalPart = parts[1];
        if (decimalPart !== undefined)
          return integerPart + "," + decimalPart;
        else return integerPart;
      };

      const updateSum = () => {
        let total = 0;
        let maxDecimalPlaces = 0;
        const inputs = inputsContainer.querySelectorAll(".value-input");
        inputs.forEach((input) => {
          const value = cleanNumber(input.value);
          const parsedValue = parseFloat(value) || 0;
          total += parsedValue;
          const decimalPart = value.split(".")[1] || "";
          if (decimalPart.length > maxDecimalPlaces)
            maxDecimalPlaces = decimalPart.length;
        });
        if (maxDecimalPlaces > 0)
          totalSumSpan.textContent = total.toLocaleString("id-ID", {
            minimumFractionDigits: maxDecimalPlaces,
            maximumFractionDigits: maxDecimalPlaces,
          });
        else
          totalSumSpan.textContent = total.toLocaleString("id-ID", {
            minimumFractionDigits: 0,
            maximumFractionDigits: 0,
          });
      };

      const addInputListeners = (input) => {
        input.addEventListener("keyup", handleInput);
        input.addEventListener("keypress", (e) => {
          if (e.key === "Enter" || e.keyCode === 13) {
            e.preventDefault();
            addNewInput();
          }
        });
      };

      const handleInput = (event) => {
        const input = event.target;
        let value = input.value;
        const sanitizedValue = value.replace(/[^0-9,.]/g, "");
        if (value !== sanitizedValue) {
          alert("Input hanya boleh berupa angka, koma, atau titik.");
          input.value = sanitizedValue;
          return;
        }
        const cursorPosition = input.selectionStart;
        const separatorsBefore = (
          value.substring(0, cursorPosition).match(/\./g) || []
        ).length;
        input.value = formatNumber(value);
        const newSeparatorsBefore = (
          input.value.substring(0, input.selectionStart).match(/\./g) || []
        ).length;
        input.selectionStart = cursorPosition + (newSeparatorsBefore - separatorsBefore);
        input.selectionEnd = cursorPosition + (newSeparatorsBefore - separatorsBefore);
        updateSum();
      };

      const addNewInput = () => {
        const rowCount = inputsContainer.children.length;
        const newRow = document.createElement("div");
        newRow.className = "input-row";
        const newNumber = document.createElement("span");
        newNumber.className = "line-number";
        newNumber.textContent = `${rowCount + 1}.`;
        const newInput = document.createElement("input");
        newInput.type = "text";
        newInput.className = "value-input";
        newInput.placeholder = "Masukkan nilai...";
        newRow.appendChild(newNumber);
        newRow.appendChild(newInput);
        inputsContainer.appendChild(newRow);
        newInput.focus();
        addInputListeners(newInput);
      };

      const resetDynamicInputs = () => {
        inputsContainer.innerHTML = `
          <div class="input-row">
            <span class="line-number">1.</span>
            <input type="text" class="value-input" placeholder="Masukkan nilai...">
          </div>`;
        const initialInput = document.querySelector(".value-input");
        initialInput.value = "";
        initialInput.focus();
        totalSumSpan.textContent = "0";
        addInputListeners(initialInput);
        updateSum();
      };

      const initialInput = document.querySelector(".value-input");
      addInputListeners(initialInput);
      resetButtonDynamic.addEventListener("click", resetDynamicInputs);
      updateSum();

      // --- Fungsionalitas Reset Semua ---
      const resetAllBtn = document.getElementById("resetAllBtn");

      function resetAllCalculators() {
        resetAgeForm();
        resetBPJSBtn.click();
        resetDynamicInputs();
        refreshListrik();
        resetAirForm();
        resetSPP.click(); // Reset Kalkulator SPP
        resetFormKJP(); // Reset Kalkulator KJP Plus
      }
      resetAllBtn.addEventListener("click", resetAllCalculators);
    </script>
  </body>
</html>
